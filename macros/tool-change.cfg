[gcode_macro UPDATE_TOOL_IO]
gcode:
  {%- import message as msg -%}
  {%- set tool = params.T | int | default(-1)-%}
  {%- if tool > -1-%}
    {%- for t in printer.toolchanger.tool_numbers -%}
      {msg.echo("Checking tool T{t}")}
      {%- if t == tool -%}
        {msg.echo("Enabling filament sensor for tool T"+t)}
        SET_FILAMENT_SENSOR SENSOR=t{t}_filament ENABLED=1
      {%- else -%}
        SET_FILAMENT_SENSOR SENSOR=t{t}_filament ENABLED=0
      {%- endif -%}
    {%- endfor -%}
  {%- endif -%}